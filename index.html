<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ferrao Generator</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Segoe UI;}

body{
background:#0f1e0f;
color:white;
display:flex;
flex-direction:column;
align-items:center;
min-height:100vh;
}

header{
width:100%;
background:#1b3a1b;
padding:15px;
display:flex;
justify-content:space-between;
align-items:center;
}

.card{
background:#1f3a1f;
padding:25px;
border-radius:20px;
margin:15px;
width:95%;
max-width:700px;
text-align:center;
transition:0.3s;
animation:fadeUp 0.6s;
}

.card:hover{
box-shadow:0 0 25px #3fc03f;
}

button{
background:#3fc03f;
border:none;
padding:12px 25px;
border-radius:12px;
color:white;
cursor:pointer;
margin-top:10px;
}

input{
width:90%;
padding:12px;
margin:10px;
border-radius:10px;
border:none;
background:#225522;
color:white;
}

table{
width:100%;
margin-top:15px;
border-collapse:collapse;
}

th,td{
padding:12px;
border-bottom:1px solid #2c5c2c;
font-size:14px;
}

.badge{
padding:4px 10px;
border-radius:8px;
font-size:12px;
}

.badge-ok{background:#a855f7;}
.badge-off{background:#ff4444;}

@keyframes fadeUp{
from{opacity:0;transform:translateY(20px)}
to{opacity:1;transform:translateY(0)}
}
</style>
</head>

<body>

<header>
<h3>Ferrao Generator</h3>
<div>
<span id="userHeader"></span>
<button id="logoutBtn" style="display:none;" onclick="logout()">Sair</button>
</div>
</header>

<div id="main"></div>

<script>

const USERS_API="https://gerador-online-9fqv.vercel.app/dados";
const KEYS_API="https://teste-api-mcok.vercel.app/keys";

let currentUser=null;
let refreshInterval=null;

function showHome(){
document.getElementById("main").innerHTML=`
<div class="card">
<h2>Bem vindo</h2>
<button onclick="showLogin()">Entrar</button>
<button onclick="showRegister()">Cadastrar</button>
</div>`;
}

function showLogin(){
document.getElementById("main").innerHTML=`
<div class="card">
<h2>Login</h2>
<input id="loginUser" placeholder="Usuário">
<input id="loginPass" type="password" placeholder="Senha">
<button onclick="login()">Entrar</button>
</div>`;
}

async function login(){
const u=document.getElementById("loginUser").value;
const p=document.getElementById("loginPass").value;

const res=await fetch(USERS_API);
const users=await res.json();

const user=users.find(x=>x.username===u && x.password===p);

if(!user){
alert("Login inválido");
return;
}

currentUser=user;

document.getElementById("logoutBtn").style.display="inline";
document.getElementById("userHeader").innerText=user.username;

if(user.admin){
showAdmin();
}else{
showDashboard();
}
}

function showRegister(){
document.getElementById("main").innerHTML=`
<div class="card">
<h2>Cadastrar</h2>
<input id="regUser" placeholder="Usuário">
<input id="regPass" type="password" placeholder="Senha">
<button onclick="register()">Criar</button>
</div>`;
}

async function register(){
await fetch(USERS_API,{
method:"POST",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({
username:regUser.value,
password:regPass.value,
plan:null,
planLimit:0,
keysGenerated:0
})
});
alert("Conta criada");
showLogin();
}

function showDashboard(){

if(!currentUser.plan){
document.getElementById("main").innerHTML=`
<div class="card">
<h2>Sem plano ativo</h2>
<button onclick="window.open('https://discord.gg/ferraocheats')">Comprar Plano</button>
</div>`;
return;
}

document.getElementById("main").innerHTML=`

<div class="card">
<h2>Dashboard</h2>
<p>Plano: ${currentUser.plan}</p>
<p>Keys: <span id="keysCount">${currentUser.keysGenerated}</span>/${currentUser.planLimit}</p>
<button onclick="generateKey()">Gerar Key</button>
</div>

<div class="card">
<h3>Minhas Chaves</h3>
<table>
<thead>
<tr>
<th>Chave</th>
<th>Tipo</th>
<th>Status</th>
<th>Ações</th>
</tr>
</thead>
<tbody id="keysTable"></tbody>
</table>
</div>
`;

loadKeys();

if(refreshInterval) clearInterval(refreshInterval);
refreshInterval=setInterval(loadKeys,2000);
}

async function generateKey(){

if(currentUser.keysGenerated>=currentUser.planLimit){
alert("Limite atingido");
return;
}

let tipo=prompt("Tipo da key");
if(!tipo) return;

let key="FERRAO-CHEATS-"+Math.random().toString(36).substring(2,10).toUpperCase();

await fetch(KEYS_API,{
method:"POST",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({
key,
type:tipo,
username:currentUser.username,
active:true
})
});

currentUser.keysGenerated++;
keysCount.innerText=currentUser.keysGenerated;

loadKeys();
}

async function loadKeys(){

const res=await fetch(KEYS_API);
const keys=await res.json();

const my=keys.filter(k=>k.username===currentUser.username);

const table=document.getElementById("keysTable");
if(!table) return;

table.innerHTML="";

my.forEach(k=>{
table.innerHTML+=`
<tr>
<td>${k.key}</td>
<td>${k.type}</td>
<td>
<span class="badge ${k.active?'badge-ok':'badge-off'}">
${k.active?'Disponível':'Revogada'}
</span>
</td>
<td>
<button onclick="revokeKey('${k.key}')">Revogar</button>
<button onclick="deleteKey('${k.key}')">Excluir</button>
</td>
</tr>`;
});
}

async function revokeKey(key){
await fetch(KEYS_API+"/"+key,{
method:"PUT",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({active:false})
});
loadKeys();
}

async function deleteKey(key){
await fetch(KEYS_API+"/"+key,{method:"DELETE"});
currentUser.keysGenerated--;
keysCount.innerText=currentUser.keysGenerated;
loadKeys();
}

async function showAdmin(){

document.getElementById("main").innerHTML=`
<div class="card">
<h2>Painel Admin</h2>
<div id="usersList"></div>
</div>`;

loadUsers();
}

async function loadUsers(){
const res=await fetch(USERS_API);
const users=await res.json();

const div=document.getElementById("usersList");
div.innerHTML="";

users.forEach(u=>{
div.innerHTML+=`
<div class="card">
<p>${u.username}</p>
<p>Plano: ${u.plan||"Nenhum"}</p>
<button onclick="setPlan('${u.username}')">Definir Plano</button>
<button onclick="removePlan('${u.username}')">Remover Plano</button>
</div>`;
});
}

async function setPlan(user){
let plan=prompt("Plano");
let limit=parseInt(prompt("Limite keys"));
let days=parseInt(prompt("Dias"));

let end=new Date(Date.now()+days*86400000).toISOString();

await fetch(USERS_API+"/"+user,{
method:"PUT",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({plan,planLimit:limit,planEnd:end})
});

loadUsers();
}

async function removePlan(user){
await fetch(USERS_API+"/"+user,{
method:"PUT",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({plan:null,planLimit:0})
});
loadUsers();
}

function logout(){
currentUser=null;
logoutBtn.style.display="none";
userHeader.innerText="";
showHome();
}

showHome();

</script>
</body>
</html>
