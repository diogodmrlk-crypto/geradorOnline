<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ferrao Generator</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Tahoma,sans-serif;}
body{background:#0f1e0f;color:#fff;display:flex;flex-direction:column;align-items:center;min-height:100vh;}

header{width:100%;background:#1b3a1b;padding:15px;display:flex;justify-content:space-between;align-items:center;position:relative;}

.menu{font-size:28px;cursor:pointer;}

.dropdown{display:none;flex-direction:column;background:#225522;width:100%;position:absolute;top:60px;left:0;z-index:999;}
.dropdown a{padding:10px;color:#fff;text-decoration:none;}

.card{
background:#1f3a1f;
padding:30px;
border-radius:20px;
margin:20px;
width:95%;
max-width:700px;
text-align:center;
transition:0.3s;
}

.card:hover{
transform:translateY(-5px);
box-shadow:0 0 25px #3fc03f;
}

button{
background:#3fc03f;
color:#fff;
border:none;
padding:10px 20px;
border-radius:12px;
cursor:pointer;
margin:5px;
font-weight:bold;
}

input{
width:90%;
padding:12px;
margin:10px 0;
border-radius:10px;
border:none;
background:#225522;
color:#fff;
}

.avatar{
width:80px;
height:80px;
border-radius:50%;
border:2px solid #3fc03f;
object-fit:cover;
}

.key-card{
background:#225522;
padding:12px;
border-radius:12px;
margin:10px;
text-align:left;
display:flex;
justify-content:space-between;
align-items:center;
}
</style>
</head>
<body>

<header>
<div>Ferrao Generator</div>

<div>
<span id="userHeader"></span>
<button id="btnLogout" style="display:none;" onclick="logout()">Sair</button>
<span class="menu" onclick="toggleMenu()">‚ò∞</span>
</div>
</header>

<div id="dropdown" class="dropdown">
<a href="#" onclick="showHome()">Home</a>
<a href="#" onclick="showLogin()">Entrar</a>
<a href="#" onclick="showRegister()">Cadastrar</a>
</div>

<div id="main"></div>

<script>
let currentUser=null;
let keysInterval=null;
let usersInterval=null;

const USERS_API="https://gerador-online-9fqv.vercel.app/dados";
const KEYS_API="https://teste-api-mcok.vercel.app/keys";

function toggleMenu(){
const d=document.getElementById("dropdown");
d.style.display=d.style.display==="flex"?"none":"flex";
}

/* HOME */

function showHome(){
document.getElementById("main").innerHTML=`
<div class="card">
<h2>Ferrao Cheats</h2>
<p>Gerador de keys profissional</p>
<button onclick="window.open('https://discord.gg/ferraocheats')">Adquirir Plano</button>
</div>`;
}

/* LOGIN */

function showLogin(){
document.getElementById("main").innerHTML=`
<div class="card">
<h2>Login</h2>
<input id="loginUser" placeholder="Usu√°rio">
<input id="loginPass" type="password" placeholder="Senha">
<button onclick="login()">Entrar</button>
<p id="loginStatus"></p>
</div>`;
}

async function login(){

const u=document.getElementById("loginUser").value;
const p=document.getElementById("loginPass").value;
const status=document.getElementById("loginStatus");

try{

const res=await fetch(USERS_API);
const users=await res.json();

const user=users.find(x=>x.username===u && x.password===p);

if(!user){
status.innerText="Usu√°rio inv√°lido";
return;
}

/* üî• CORRE√á√ÉO ADMIN */
if(user.username==="admin"){
user.admin=true;
}

currentUser=user;

showDashboard();

}catch{
status.innerText="Erro API";
}

}

/* REGISTER */

function showRegister(){
document.getElementById("main").innerHTML=`
<div class="card">
<h2>Cadastrar</h2>
<input id="regUser" placeholder="Usu√°rio">
<input id="regPass" type="password" placeholder="Senha">
<button onclick="register()">Cadastrar</button>
<p id="regStatus"></p>
</div>`;
}

async function register(){

const u=document.getElementById("regUser").value;
const p=document.getElementById("regPass").value;

await fetch(USERS_API,{
method:"POST",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({
username:u,
password:p,
plan:null,
keysGenerated:0,
planLimit:0
})
});

alert("Cadastrado!");
showLogin();
}

/* DASHBOARD */

function showDashboard(){

document.getElementById("btnLogout").style.display="inline";
document.getElementById("userHeader").innerText=currentUser.username;

if(currentUser.admin){
showAdminPanel();
}else{
showUserPanel();
}

}

/* ADMIN */

async function showAdminPanel(){

document.getElementById("main").innerHTML=`
<div class="card">
<h2>Painel Admin</h2>
<div id="usersList"></div>
</div>`;

loadUsers();
usersInterval=setInterval(loadUsers,3000);

}

async function loadUsers(){

const res=await fetch(USERS_API);
const users=await res.json();

const div=document.getElementById("usersList");
div.innerHTML="";

users.forEach(u=>{

div.innerHTML+=`
<div class="key-card">
<div>
<b>${u.username}</b><br>
Plano: ${u.plan||"Nenhum"}
</div>

<div>
<button onclick="setPlan('${u.username}')">Plano</button>
<button onclick="removePlan('${u.username}')">Revogar</button>
</div>
</div>`;
});

}

async function setPlan(username){

const plan=prompt("basico / avancado");
const limit=parseInt(prompt("limite keys"));

await fetch(`${USERS_API}/${username}`,{
method:"PUT",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({
plan:plan,
planLimit:limit
})
});

}

async function removePlan(username){

await fetch(`${USERS_API}/${username}`,{
method:"PUT",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({
plan:null,
planLimit:0
})
});

}

/* USER PANEL */

function showUserPanel(){

document.getElementById("main").innerHTML=`
<div class="card">
<h2>Dashboard</h2>
<p>Plano: ${currentUser.plan||"Nenhum"}</p>
<p>Keys: <span id="keysCount">${currentUser.keysGenerated||0}</span>/${currentUser.planLimit||0}</p>
<button onclick="generateKey()">Gerar Key</button>
</div>

<div id="userKeys"></div>`;

loadKeys();
keysInterval=setInterval(loadKeys,3000);

}

function generateKey(){

if(!currentUser.plan){
alert("Sem plano");
return;
}

const random=Math.random().toString(36).substring(2,8).toUpperCase();
const key=`FERRAO-CHEATS-${random}`;

fetch(KEYS_API,{
method:"POST",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({
key:key,
username:currentUser.username,
active:true
})
});

}

/* LOAD KEYS */

async function loadKeys(){

const res=await fetch(KEYS_API);
const keys=await res.json();

const div=document.getElementById("userKeys");
div.innerHTML="";

keys.filter(k=>k.username===currentUser.username)
.forEach(k=>{

div.innerHTML+=`
<div class="key-card">
<div>
<b>${k.key}</b><br>
Status: ${k.active?"Ativa":"Revogada"}
</div>

<div>
<button onclick="revokeKey('${k.key}')">Revogar</button>
<button onclick="deleteKey('${k.key}')">Excluir</button>
</div>
</div>`;
});

}

/* KEY ACTIONS */

function revokeKey(key){
fetch(`${KEYS_API}/${key}`,{
method:"PUT",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({active:false})
});
}

function deleteKey(key){
fetch(`${KEYS_API}/${key}`,{method:"DELETE"});
}

/* LOGOUT */

function logout(){
currentUser=null;
location.reload();
}

showHome();
</script>

</body>
</html>
