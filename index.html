<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ferrao Generator</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Segoe UI;}

body{
background:#0f1e0f;
color:white;
display:flex;
flex-direction:column;
align-items:center;
min-height:100vh;
}

.card{
background:#1f3a1f;
padding:25px;
border-radius:20px;
margin:15px;
width:95%;
max-width:700px;
text-align:center;
}

button{
background:#3fc03f;
border:none;
padding:12px 25px;
border-radius:12px;
color:white;
cursor:pointer;
margin-top:10px;
}

select{
width:90%;
padding:12px;
margin:10px;
border-radius:10px;
border:none;
background:#225522;
color:white;
}

table{
width:100%;
margin-top:15px;
border-collapse:collapse;
}

th,td{
padding:12px;
border-bottom:1px solid #2c5c2c;
}

.badge{
padding:5px 12px;
border-radius:8px;
font-size:12px;
}

.badge-ok{background:#a855f7;}
.badge-off{background:#ff4444;}
</style>
</head>

<body>

<div id="app"></div>

<script>

const USERS_API="https://gerador-online-9fqv.vercel.app/dados";
const KEYS_API="https://teste-api-mcok.vercel.app/keys";

let currentUser=null;
let refreshInterval=null;

function home(){
app.innerHTML=`
<div class="card">
<h2>Login</h2>
<input id="user" placeholder="Usuário">
<input id="pass" type="password" placeholder="Senha">
<button onclick="login()">Entrar</button>
</div>`;
}

async function login(){

const res=await fetch(USERS_API);
const users=await res.json();

const u=user.value;
const p=pass.value;

const found=users.find(x=>x.username===u && x.password===p);

if(!found) return alert("Login inválido");

currentUser=found;
dashboard();
}

function dashboard(){

if(!currentUser.plan){
app.innerHTML=`<div class="card"><h2>Sem plano</h2></div>`;
return;
}

app.innerHTML=`
<div class="card">
<h2>Gerar Key</h2>

<select id="tipo">
<option value="1H">1 Hora</option>
<option value="1D">1 Dia</option>
<option value="7D">7 Dias</option>
<option value="30D">30 Dias</option>
<option value="LIFETIME">Lifetime</option>
</select>

<button onclick="generateKey()">Gerar</button>

<p>Keys usadas: <span id="count">${currentUser.keysGenerated||0}</span> / ${currentUser.planLimit}</p>
</div>

<div class="card">
<h3>Minhas Chaves</h3>
<table>
<thead>
<tr>
<th>Key</th>
<th>Tipo</th>
<th>Status</th>
<th>Ações</th>
</tr>
</thead>
<tbody id="keysList"></tbody>
</table>
</div>
`;

loadKeys();

if(refreshInterval) clearInterval(refreshInterval);
refreshInterval=setInterval(loadKeys,3000);
}

async function generateKey(){

if((currentUser.keysGenerated||0)>=currentUser.planLimit){
alert("Limite atingido");
return;
}

const tipo=document.getElementById("tipo").value;

const key="FERRAO-CHEATS-"+Math.random().toString(36).substring(2,10).toUpperCase();

await fetch(KEYS_API,{
method:"POST",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({
key:key,
type:tipo,
username:currentUser.username,
active:true,
created:new Date().toISOString()
})
});

currentUser.keysGenerated=(currentUser.keysGenerated||0)+1;
count.innerText=currentUser.keysGenerated;

loadKeys();
}

async function loadKeys(){

const res=await fetch(KEYS_API);
const keys=await res.json();

const myKeys=keys.filter(k=>k.username===currentUser.username);

keysList.innerHTML="";

myKeys.forEach(k=>{
keysList.innerHTML+=`
<tr>
<td>${k.key}</td>
<td>${k.type}</td>
<td>
<span class="badge ${k.active?'badge-ok':'badge-off'}">
${k.active?'Disponível':'Revogada'}
</span>
</td>
<td>
<button onclick="revoke('${k.key}')">Revogar</button>
<button onclick="del('${k.key}')">Excluir</button>
</td>
</tr>`;
});
}

async function revoke(key){
await fetch(KEYS_API+"/"+key,{
method:"PUT",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({active:false})
});
loadKeys();
}

async function del(key){
await fetch(KEYS_API+"/"+key,{method:"DELETE"});
currentUser.keysGenerated--;
count.innerText=currentUser.keysGenerated;
loadKeys();
}

home();

</script>
</body>
</html>
