<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ferrao Generator</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Tahoma,sans-serif;}
body{background:#0f1e0f;color:#fff;display:flex;flex-direction:column;align-items:center;min-height:100vh;}
header{width:100%;background:#1b3a1b;padding:15px;display:flex;justify-content:space-between;align-items:center;position:relative;}
.menu{font-size:28px;cursor:pointer;}
.dropdown{display:none;flex-direction:column;background:#225522;width:100%;position:absolute;top:60px;left:0;z-index:999;}
.dropdown a{padding:10px;color:#fff;text-decoration:none;}
.card{background:#1f3a1f;padding:30px;border-radius:20px;margin:20px;width:95%;max-width:600px;text-align:center;transition: all 0.3s;}
.card:hover{transform: translateY(-5px);box-shadow:0 0 25px #3fc03f;}
button{background:#3fc03f;color:#fff;border:none;padding:12px 25px;border-radius:12px;cursor:pointer;margin:5px;font-weight:bold;}
input{width:90%;padding:12px;margin:10px 0;border-radius:10px;border:none;background:#225522;color:#fff;font-size:16px;}
.avatar{width:80px;height:80px;border-radius:50%;object-fit:cover;border:2px solid #3fc03f;cursor:pointer;margin-bottom:10px;}

.key-card{background:#225522;padding:12px;border-radius:12px;margin:10px;text-align:left;display:flex;justify-content:space-between;align-items:center;}
.key-card div{flex:1;}
.key-card p{margin:4px 0;font-size:14px;}
.key-card button{background:#ff5555;padding:6px 12px;font-size:13px;margin:2px;}
</style>
</head>

<body>

<header>
<div>Ferrao Generator</div>
<div>
<span id="userHeader"></span>
<button id="btnLogout" style="display:none;" onclick="logout()">Sair</button>
<span class="menu" onclick="toggleMenu()">☰</span>
</div>
</header>

<div id="dropdown" class="dropdown">
<a onclick="showHome()">Home</a>
<a onclick="showLogin()">Entrar</a>
<a onclick="showRegister()">Cadastrar</a>
</div>

<div id="main"></div>

<script>
const USERS_API="https://gerador-online-9fqv.vercel.app/dados";
const KEYS_API="https://teste-api-mcok.vercel.app/keys";

let currentUser=null;
let keyInterval=null;

function toggleMenu(){
const d=document.getElementById("dropdown");
d.style.display=d.style.display==="flex"?"none":"flex";
}

function showHome(){
document.getElementById("main").innerHTML=`
<div class="card">
<h2>Bem vindo ao Ferrao Generator</h2>
<button onclick="window.open('https://discord.gg/ferraocheats')">Adquirir Plano</button>
</div>`;
}

function showLogin(){
document.getElementById("main").innerHTML=`
<div class="card">
<h2>Entrar</h2>
<input id="loginUser" placeholder="Usuário">
<input id="loginPass" type="password" placeholder="Senha">
<button onclick="login()">Entrar</button>
<p id="loginStatus"></p>
</div>`;
}

async function login(){
let u=document.getElementById("loginUser").value.trim();
let p=document.getElementById("loginPass").value.trim();

const res=await fetch(USERS_API);
const users=await res.json();

const user=users.find(x=>x.username===u && x.password===p);

if(!user){
document.getElementById("loginStatus").innerText="Login inválido";
return;
}

currentUser=user;
document.getElementById("btnLogout").style.display="inline-block";
document.getElementById("userHeader").innerText=u;

if(user.admin){
showAdmin();
}else{
showUser();
}
}

function showRegister(){
document.getElementById("main").innerHTML=`
<div class="card">
<h2>Cadastrar</h2>
<input id="regUser" placeholder="Usuário">
<input id="regPass" type="password" placeholder="Senha">
<button onclick="register()">Cadastrar</button>
</div>`;
}

async function register(){
let u=document.getElementById("regUser").value.trim();
let p=document.getElementById("regPass").value.trim();

await fetch(USERS_API,{
method:"POST",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({
username:u,
password:p,
plan:null,
planLimit:0,
keysGenerated:0
})
});

alert("Conta criada");
showLogin();
}

function showUser(){

if(!currentUser.plan){
document.getElementById("main").innerHTML=`
<div class="card">
<h2>Você não possui plano</h2>
<button onclick="window.open('https://discord.gg/ferraocheats')">Comprar Plano</button>
</div>`;
return;
}

document.getElementById("main").innerHTML=`
<div class="card">
<h2>Dashboard</h2>
<p>Plano: ${currentUser.plan}</p>
<p>Keys: <span id="keysCount">${currentUser.keysGenerated}</span>/${currentUser.planLimit}</p>
<button onclick="generateKey()">Gerar Key</button>
</div>

<div id="keysList"></div>
`;

loadKeys();

if(keyInterval) clearInterval(keyInterval);
keyInterval=setInterval(loadKeys,3000);
}

async function generateKey(){

if(currentUser.keysGenerated>=currentUser.planLimit){
alert("Limite atingido");
return;
}

let tipo=prompt("Tipo (hour/day/month/year)");
if(!tipo) return;

let key="FERRAO-CHEATS-"+Math.random().toString(36).substring(2,10).toUpperCase();

await fetch(KEYS_API,{
method:"POST",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({
key,
type:tipo,
username:currentUser.username,
active:true
})
});

currentUser.keysGenerated++;
document.getElementById("keysCount").innerText=currentUser.keysGenerated;

loadKeys();
}

async function loadKeys(){
const res=await fetch(KEYS_API);
const keys=await res.json();

const my=keys.filter(k=>k.username===currentUser.username);

const div=document.getElementById("keysList");
if(!div) return;

div.innerHTML="";

my.forEach(k=>{
div.innerHTML+=`
<div class="key-card">
<div>
<p><b>${k.key}</b></p>
<p>Tipo: ${k.type}</p>
<p>Status: ${k.active?"Ativa":"Revogada"}</p>
</div>
<div>
<button onclick="revoke('${k.key}')">Revogar</button>
<button onclick="deleteKey('${k.key}')">Excluir</button>
</div>
</div>`;
});
}

async function revoke(key){
await fetch(KEYS_API+"/"+key,{
method:"PUT",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({active:false})
});
loadKeys();
}

async function deleteKey(key){
await fetch(KEYS_API+"/"+key,{method:"DELETE"});
currentUser.keysGenerated--;
document.getElementById("keysCount").innerText=currentUser.keysGenerated;
loadKeys();
}

async function showAdmin(){

document.getElementById("main").innerHTML=`
<div class="card">
<h2>Painel Admin</h2>
<div id="usersList"></div>
</div>`;

loadUsers();
}

async function loadUsers(){
const res=await fetch(USERS_API);
const users=await res.json();

const div=document.getElementById("usersList");
div.innerHTML="";

users.forEach(u=>{
div.innerHTML+=`
<div class="card">
<p>${u.username}</p>
<p>Plano: ${u.plan||"Nenhum"}</p>
<button onclick="setPlan('${u.username}')">Definir Plano</button>
<button onclick="removePlan('${u.username}')">Remover Plano</button>
</div>`;
});
}

async function setPlan(user){
let plan=prompt("Plano:");
let limit=parseInt(prompt("Limite keys"));
let days=parseInt(prompt("Dias"));

let planEnd=new Date(Date.now()+days*86400000).toISOString();

await fetch(USERS_API+"/"+user,{
method:"PUT",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({plan,planLimit:limit,planEnd})
});

loadUsers();
}

async function removePlan(user){
await fetch(USERS_API+"/"+user,{
method:"PUT",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({plan:null,planLimit:0})
});
loadUsers();
}

function logout(){
currentUser=null;
document.getElementById("btnLogout").style.display="none";
document.getElementById("userHeader").innerText="";
showHome();
}

showHome();
</script>

</body>
</html>
