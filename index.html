<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ferrao Generator</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Tahoma,sans-serif;}

body{
background:#0f1e0f;
color:#fff;
display:flex;
flex-direction:column;
align-items:center;
min-height:100vh;
}

header{
width:100%;
background:#1b3a1b;
padding:15px;
display:flex;
justify-content:space-between;
align-items:center;
}

.menu{font-size:28px;cursor:pointer;}

.dropdown{
display:none;
flex-direction:column;
background:#225522;
width:100%;
position:absolute;
top:60px;
left:0;
z-index:999;
}

.dropdown a{
padding:10px;
color:#fff;
text-decoration:none;
}

.card{
background:#1f3a1f;
padding:25px;
border-radius:20px;
margin:20px;
width:95%;
max-width:650px;
text-align:center;
transition:0.3s;
}

button{
background:#3fc03f;
color:#fff;
border:none;
padding:12px 25px;
border-radius:12px;
cursor:pointer;
margin:5px;
font-weight:bold;
}

input,select{
width:90%;
padding:12px;
margin:10px 0;
border-radius:10px;
border:none;
background:#225522;
color:#fff;
font-size:16px;
}

.keyItem{
background:#225522;
padding:10px;
border-radius:10px;
margin-top:8px;
text-align:left;
}
</style>
</head>

<body>

<header>
<div>Ferrao Generator</div>
<div>
<span id="userHeader"></span>
<button id="btnLogout" onclick="logout()" style="display:none;">Sair</button>
<span class="menu" onclick="toggleMenu()">☰</span>
</div>
</header>

<div id="dropdown" class="dropdown">
<a onclick="showHome()">Home</a>
<a onclick="showLogin()">Entrar</a>
<a onclick="showRegister()">Cadastrar</a>
</div>

<div id="main"></div>

<script>

let currentUser=null;

const USERS_API="https://gerador-online-9fqv.vercel.app/dados";
const KEYS_API="https://teste-api-mcok.vercel.app/keys";

function toggleMenu(){
dropdown.style.display=dropdown.style.display==="flex"?"none":"flex";
}

function showHome(){
main.innerHTML=`
<div class="card">
<h2>Bem vindo</h2>
<p>Sistema de geração de keys</p>
</div>`;
}

function showLogin(){
main.innerHTML=`
<div class="card">
<h2>Login</h2>
<input id="loginUser" placeholder="Usuário">
<input id="loginPass" type="password" placeholder="Senha">
<button onclick="login()">Entrar</button>
</div>`;
}

async function login(){
const u=loginUser.value;
const p=loginPass.value;

const res=await fetch(USERS_API);
const users=await res.json();

const user=users.find(x=>x.username===u && x.password===p);

if(!user) return alert("Login inválido");

currentUser=user;

btnLogout.style.display="inline-block";
userHeader.innerText=user.username;

showDashboard();
}

function showRegister(){
main.innerHTML=`
<div class="card">
<h2>Cadastrar</h2>
<input id="regUser" placeholder="Usuário">
<input id="regPass" placeholder="Senha">
<button onclick="register()">Cadastrar</button>
</div>`;
}

async function register(){
await fetch(USERS_API,{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({
username:regUser.value,
password:regPass.value,
plan:"basico"
})
});
alert("Criado");
showLogin();
}

function showDashboard(){

// ADMIN
if(currentUser.admin){

main.innerHTML=`
<div class="card">
<h2>Painel Admin</h2>
<button onclick="loadAllKeys()">Ver Todas Keys</button>
<div id="adminKeys"></div>
</div>`;
return;
}

// USER BASICO GERADOR
main.innerHTML=`

<div class="card">

<h2>Gerador de Keys</h2>

<label>Prefixo</label>
<input id="prefix" value="FERRAO-CHEATS-">

<label>Quantidade</label>
<input id="qty" type="number" value="1">

<label>Tipo</label>
<select id="type">
<option value="hour">1 Hora</option>
<option value="day">1 Dia</option>
<option value="month">1 Mês</option>
</select>

<button onclick="generate()">Gerar</button>

<pre id="genOut">---</pre>

</div>

<div class="card">
<h2>Minhas Keys</h2>
<div id="userKeys"></div>
</div>

`;

loadUserKeys();
}

function rand(len){
const chars="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
let s="";
for(let i=0;i<len;i++){
s+=chars[Math.floor(Math.random()*chars.length)];
}
return s;
}

async function generate(){

if(!currentUser.plan) return alert("Você não possui plano");

genOut.textContent="";

for(let i=0;i<qty.value;i++){

const key=prefix.value+rand(8);

await fetch(KEYS_API,{
method:"POST",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({
key:key,
type:type.value,
username:currentUser.username,
used:false,
device:null
})
});

genOut.textContent+=key+"\n";
}

await loadUserKeys();
}

async function loadUserKeys(){

const res=await fetch(KEYS_API);
const data=await res.json();

userKeys.innerHTML="";

data
.filter(k=>k.username===currentUser.username)
.forEach(k=>{

userKeys.innerHTML+=`
<div class="keyItem">
<b>${k.key}</b><br>
Tipo: ${k.type}<br>
Device: ${k.device||"—"}<br>

<button onclick="revokeKey('${k.key}')">Revogar</button>
<button onclick="resetDevice('${k.key}')">Resetar</button>
<button onclick="deleteKey('${k.key}')">Excluir</button>

</div>`;
});
}

async function loadAllKeys(){

const res=await fetch(KEYS_API);
const data=await res.json();

adminKeys.innerHTML="";

data.forEach(k=>{
adminKeys.innerHTML+=`
<div class="keyItem">
<b>${k.key}</b> — ${k.username}
</div>`;
});
}

async function revokeKey(key){
await fetch(KEYS_API+"/"+key,{
method:"PUT",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({used:true})
});
loadUserKeys();
}

async function resetDevice(key){
await fetch(KEYS_API+"/"+key,{
method:"PUT",
headers:{"Content-Type":"application/json"},
body:JSON.stringify({device:null})
});
loadUserKeys();
}

async function deleteKey(key){
await fetch(KEYS_API+"/"+key,{method:"DELETE"});
loadUserKeys();
}

function logout(){
currentUser=null;
btnLogout.style.display="none";
userHeader.innerText="";
showHome();
}

showHome();

</script>
</body>
</html>
