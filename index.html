<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ferrao Generator</title>
<style>
  * { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI', Tahoma, sans-serif; }
  body { background:#121212; color:#fff; display:flex; flex-direction:column; align-items:center; min-height:100vh; }
  header { width:100%; background:#1f1f1f; padding:15px 20px; display:flex; justify-content:space-between; align-items:center; box-shadow:0 2px 10px rgba(0,0,0,0.5); }
  .menu { font-size:28px; cursor:pointer; user-select:none; }
  .dropdown { display:none; flex-direction:column; background:#2a2a2a; width:100%; text-align:center; }
  .dropdown a { padding:12px; text-decoration:none; color:#fff; border-bottom:1px solid #333; transition:0.2s; }
  .dropdown a:hover { background:#3a3a3a; }
  h1,h2,h3 { margin:20px 0; text-align:center; }
  .card { background:#1e1e1e; padding:20px; border-radius:12px; margin:15px 0; width:90%; max-width:450px; box-shadow:0 4px 20px rgba(0,0,0,0.5); text-align:center; transition:0.3s; }
  .card:hover { transform: translateY(-3px); }
  button { background:#ff5722; color:#fff; border:none; padding:12px 25px; margin:10px 0; border-radius:8px; cursor:pointer; font-weight:bold; transition:0.3s; }
  button:hover { background:#ff7043; }
  input { width:90%; padding:12px; margin:8px 0; border-radius:8px; border:none; background:#2a2a2a; color:#fff; }
  input::placeholder { color:#aaa; }
  #keys div { background:#333; margin:5px 0; padding:8px; border-radius:5px; word-wrap:break-word; display:flex; justify-content:space-between; align-items:center; }
  #keys div button { background:#ff4444; padding:5px 10px; font-size:12px; margin:0; border-radius:5px; cursor:pointer; }
  @media(max-width:600px){ h1,h2,h3{ font-size:22px;} button,input{ width:95%; font-size:16px; } }
</style>
</head>
<body>

<header>
  <div>Ferrao Generator</div>
  <div class="menu" onclick="toggleMenu()">☰</div>
</header>

<div id="dropdown" class="dropdown">
  <a href="#" onclick="showHome()">Home</a>
  <a href="#" onclick="showLogin()">Entrar</a>
  <a href="#" onclick="showRegister()">Cadastrar</a>
</div>

<div id="main"></div>

<script>
// ====== Variáveis Globais ======
let currentUser = null;
const apiKeys = "https://teste-api-mcok.vercel.app/keys";

// ====== Menu ======
function toggleMenu(){
  const dd = document.getElementById("dropdown");
  dd.style.display = dd.style.display==='flex'?'none':'flex';
}

// ====== Páginas ======
function showHome(){
  document.getElementById("main").innerHTML = `
    <h1>Bem-vindo ao Ferrao Generator</h1>
    <p>Login ou cadastre-se para gerar keys</p>
  `;
}

function showLogin(){
  document.getElementById("main").innerHTML = `
    <div class="card">
      <h2>Entrar</h2>
      <input type="text" id="loginUser" placeholder="Usuário">
      <input type="password" id="loginPass" placeholder="Senha">
      <button onclick="login()">Entrar</button>
    </div>
  `;
}

function showRegister(){
  document.getElementById("main").innerHTML = `
    <div class="card">
      <h2>Cadastrar</h2>
      <input type="text" id="regUser" placeholder="Usuário">
      <input type="password" id="regPass" placeholder="Senha">
      <button onclick="register()">Cadastrar</button>
    </div>
  `;
}

function showDashboard(){
  if(currentUser.admin){
    document.getElementById("main").innerHTML = `
      <h2>Painel Admin</h2>
      <button onclick="createKey()">Criar Key</button>
      <h3>Keys:</h3>
      <div id="keys"></div>
    `;
    listKeys();
  } else {
    document.getElementById("main").innerHTML = `
      <h2>Dashboard Usuário</h2>
      <button onclick="createKey()">Gerar Key</button>
      <div id="keys"></div>
    `;
    listKeys();
  }
}

// ====== LocalStorage Users ======
function getData(){ 
  return JSON.parse(localStorage.getItem("db") || '{"users":[{"username":"Ferraodev","password":"Diogomiranda00k","admin":true}]}'); 
}
function saveData(d){ localStorage.setItem("db", JSON.stringify(d)); }

async function login(){
  const u = document.getElementById("loginUser").value;
  const p = document.getElementById("loginPass").value;
  let db = getData();
  let user = db.users.find(x => x.username===u && x.password===p);
  if(!user){ alert("Login inválido"); return; }
  currentUser = user;
  showDashboard();
}

async function register(){
  const u = document.getElementById("regUser").value;
  const p = document.getElementById("regPass").value;
  let db = getData();
  if(db.users.find(x => x.username===u)){ alert("Usuário já existe"); return; }
  let newUser = {username:u, password:p, admin:false};
  db.users.push(newUser);
  saveData(db);
  alert("Cadastro realizado!");
  showLogin();
}

// ====== Keys API ======
async function createKey(){
  const type = prompt("Tipo (hour/day/month/year)");
  if(!type) return;
  try{
    const res = await fetch(apiKeys,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({type})
    });
    const data = await res.json();
    alert("Key gerada: "+data.key);
    listKeys();
  }catch(e){ alert("Erro ao gerar key"); console.error(e); }
}

async function listKeys(){
  try{
    const res = await fetch(apiKeys);
    const keys = await res.json();
    const div = document.getElementById("keys");
    if(!div) return;
    div.innerHTML = "";
    keys.forEach(k=>{
      const d = document.createElement("div");
      d.innerHTML = `${k.key} - ${k.type} - Revoked: ${k.revoked}`;
      if(currentUser.admin){
        const btn = document.createElement("button");
        btn.textContent="Revogar";
        btn.onclick = ()=>revokeKey(k.key);
        d.appendChild(btn);
      }
      div.appendChild(d);
    });
  }catch(e){ console.error(e); }
}

async function revokeKey(key){
  try{
    await fetch(`${apiKeys}/${key}`,{method:"PATCH"});
    listKeys();
  }catch(e){ alert("Erro ao revogar"); }
}

// ====== Inicialização ======
showHome();
</script>

</body>
</html>
