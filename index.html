<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ferrao Generator</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Tahoma,sans-serif;}
body{background:#0f1e0f;color:#fff;display:flex;flex-direction:column;align-items:center;min-height:100vh;}
header{width:100%;background:#1b3a1b;padding:15px;display:flex;justify-content:space-between;align-items:center;position:relative;}
.menu{font-size:28px;cursor:pointer;}
.dropdown{display:none;flex-direction:column;background:#225522;width:100%;position:absolute;top:60px;left:0;z-index:999;}
.dropdown a{padding:10px;color:#fff;text-decoration:none;}
.card{background:#1f3a1f;padding:30px;border-radius:20px;margin:20px;width:95%;max-width:700px;text-align:center;transition: all 0.3s;}
.card:hover{transform: translateY(-5px);box-shadow:0 0 25px #3fc03f;}
button{background:#3fc03f;color:#fff;border:none;padding:12px 25px;border-radius:12px;cursor:pointer;margin:5px;font-weight:bold;}
input{width:90%;padding:12px;margin:10px 0;border-radius:10px;border:none;background:#225522;color:#fff;font-size:16px;}
.avatar{width:80px;height:80px;border-radius:50%;object-fit:cover;border:2px solid #3fc03f;cursor:pointer;margin-bottom:10px;}
.cards-container{display:flex; flex-wrap:wrap; justify-content:center; margin-top:20px;}
.cards-container .card{flex:1 1 300px;margin:15px;}
.key-card{background:#225522;padding:15px;border-radius:15px;margin:12px;text-align:left;display:flex;justify-content:space-between;align-items:center;}
.key-card div{flex:1;}
.key-card p{margin:4px 0;font-size:14px;}
.key-card button{background:#ff5555;padding:6px 12px;font-size:13px;margin:2px;}
</style>
</head>

<body>

<header>
<div>Ferrao Generator</div>
<div>
<span id="userHeader"></span>
<button id="btnLogout" style="display:none;" onclick="logout()">Sair</button>
<span class="menu" onclick="toggleMenu()">☰</span>
</div>
</header>

<div id="dropdown" class="dropdown">
<a onclick="showHome()">Home</a>
<a onclick="showLogin()">Entrar</a>
<a onclick="showRegister()">Cadastrar</a>
</div>

<div id="main"></div>

<script>
let currentUser=null
let keysInterval=null

const USERS_API="https://gerador-online-9fqv.vercel.app/dados"
const KEYS_API="https://teste-api-mcok.vercel.app/keys"

function toggleMenu(){
const d=document.getElementById("dropdown")
d.style.display=d.style.display==="flex"?"none":"flex"
}

/* HOME */
function showHome(){
document.getElementById("main").innerHTML=`
<div class="cards-container">

<div class="card">
<h2>Gerador de Keys</h2>
<p>Crie suas keys rapidamente</p>
</div>

<div class="card">
<h2>Controle de Planos</h2>
<p>Gerencie usuários</p>
</div>

<div class="card">
<h2>Segurança</h2>
<p>Revogue e resete devices</p>
</div>

<div class="card">
<h2>Suporte</h2>
<button onclick="window.open('https://discord.gg/ferraocheats')">Adquirir Plano</button>
</div>

</div>`
}

/* LOGIN */
function showLogin(){
document.getElementById("main").innerHTML=`
<div class="card">
<h2>Entrar</h2>
<input id="loginUser" placeholder="Usuário">
<input id="loginPass" type="password" placeholder="Senha">
<button onclick="login()">Entrar</button>
<p id="loginStatus" style="color:red;"></p>
</div>`
}

async function login(){

let u=document.getElementById("loginUser").value.trim()
let p=document.getElementById("loginPass").value.trim()

try{

let res=await fetch(USERS_API)
let users=await res.json()

let user=users.find(x=>x.username===u && x.password===p)

if(!user){
document.getElementById("loginStatus").innerText="Login inválido"
return
}

currentUser=user
showDashboard()

}catch{
document.getElementById("loginStatus").innerText="Erro API"
}

}

/* REGISTER */
function showRegister(){
document.getElementById("main").innerHTML=`
<div class="card">
<h2>Cadastrar</h2>
<input id="regUser" placeholder="Usuário">
<input id="regPass" type="password" placeholder="Senha">
<button onclick="register()">Cadastrar</button>
<p id="regStatus" style="color:red;"></p>
</div>`
}

async function register(){

let u=document.getElementById("regUser").value.trim()
let p=document.getElementById("regPass").value.trim()

try{

let res=await fetch(USERS_API,{
method:"POST",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({
username:u,
password:p,
plan:null,
keysGenerated:0,
planLimit:0
})
})

if(!res.ok){
document.getElementById("regStatus").innerText="Erro cadastro"
return
}

alert("Conta criada")
showLogin()

}catch{
document.getElementById("regStatus").innerText="Erro API"
}

}

/* DASHBOARD */
function showDashboard(){

document.getElementById("btnLogout").style.display="inline"
document.getElementById("userHeader").innerText=currentUser.username

document.getElementById("main").innerHTML=`

<div class="card">
<h2>Dashboard</h2>
<p>Plano: ${currentUser.plan || "Sem plano"}</p>
<p>Keys: <span id="keysCount">${currentUser.keysGenerated || 0}</span>/${currentUser.planLimit || 0}</p>
<button onclick="generateKey()">Gerar Key</button>
</div>

<div id="userKeys"></div>
`

loadKeys()

if(keysInterval) clearInterval(keysInterval)
keysInterval=setInterval(loadKeys,2000)

}

/* GERAR KEY */
async function generateKey(){

if(!currentUser.plan){
alert("Compre um plano")
return
}

if(currentUser.keysGenerated>=currentUser.planLimit){
alert("Limite atingido")
return
}

let tipo=prompt("Tipo hour/day/month/year")
if(!tipo) return

let key="FERRAO-CHEATS-"+Math.random().toString(36).substring(2,10).toUpperCase()

await fetch(KEYS_API,{
method:"POST",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({
key:key,
type:tipo,
username:currentUser.username,
deviceUsed:null,
active:true
})
})

currentUser.keysGenerated++
document.getElementById("keysCount").innerText=currentUser.keysGenerated
loadKeys()

}

/* LOAD KEYS */
async function loadKeys(){

if(!currentUser) return

try{

let res=await fetch(KEYS_API)
let keys=await res.json()

let userKeys=keys.filter(k=>k.username===currentUser.username)

let div=document.getElementById("userKeys")
if(!div) return

div.innerHTML=""

userKeys.forEach(k=>{

div.innerHTML+=`

<div class="key-card">

<div>
<p><b>Key:</b> ${k.key}</p>
<p><b>Tipo:</b> ${k.type}</p>
<p><b>Device:</b> ${k.deviceUsed || "Nenhum"}</p>
<p><b>Status:</b> ${k.active ? "Ativa":"Revogada"}</p>
</div>

<div>
<button onclick="revokeKey('${k.key}')">Revogar</button>
<button onclick="resetDevice('${k.key}')">Reset</button>
<button onclick="deleteKey('${k.key}')">Excluir</button>
</div>

</div>
`

})

}catch(e){
console.log(e)
}

}

/* AÇÕES KEY */
function revokeKey(k){
fetch(KEYS_API+"/"+k,{
method:"PUT",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({active:false})
}).then(loadKeys)
}

function resetDevice(k){
fetch(KEYS_API+"/"+k,{
method:"PUT",
headers:{'Content-Type':'application/json'},
body:JSON.stringify({deviceUsed:null})
}).then(loadKeys)
}

function deleteKey(k){
fetch(KEYS_API+"/"+k,{method:"DELETE"})
.then(()=>{
currentUser.keysGenerated--
document.getElementById("keysCount").innerText=currentUser.keysGenerated
loadKeys()
})
}

/* LOGOUT */
function logout(){
currentUser=null
document.getElementById("btnLogout").style.display="none"
document.getElementById("userHeader").innerText=""
showHome()
}

showHome()
</script>
</body>
</html>
